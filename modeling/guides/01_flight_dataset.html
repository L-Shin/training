<style type="text/css" media="screen">
/*
.nodes-image {
	margin:-100;
}
*/	
@import url("//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css");

.imageblock .content img, .image img {max-width: 900px;max-height: 300px;}
.deck h3, .deck h4 {display: block !important;margin-bottom:8px;margin-top:5px;}
.listingblock {margin:8px;}
.pull-bottom {position:relative;bottom:1em;}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.admonitionblock.note.speaker { display:none; }
</style>
<style type="text/css" media="screen">
#editor.maximize-editor .CodeMirror-code { font-size:24px; line-height:26px; }
</style>
<article class="guide" ng-controller="AdLibDataController">
  <carousel class="deck container-fluid">
    <!--slide class="row-fluid">
      <div class="col-sm-3">
        <h3>Intro to The Flight Dataset</h3>
        <p class="lead">Information</p>
			<!dl>
				
				
				
				
				
			</dl>
		</div>
      <div class="col-sm-9">
        <figure>
          <img style="width:300px" src=""/>
        </figure>
      </div>
    </slide-->
    


<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Intro to The Flight Dataset</h3>
    <br/>
    <div>
      <div class="paragraph">
<p>Welcome to the first of a set of interactive guides.
In these guides we&#8217;ll evolve a dataset containing the flights between US airports in 2008.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s get started!</p>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Start with a question</h3>
    <br/>
    <div>
      <div class="paragraph">
<p>When modeling a dataset it always helps to have a use case in mind.
We&#8217;ll start with the following question:</p>
</div>
<div class="verseblock">
<pre class="content">As a plane enthusiast
I want to know how many flights there are between &lt;origin&gt; and &lt;destination&gt;
So that I can know how busy various airports are</pre>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look what data we&#8217;ve got to help us answer this question:</p>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Exploring data with <code>LOAD CSV</code></h3>
    <br/>
    <div>
      <div class="paragraph">
<p>As we saw from our brief command line exploration, we&#8217;ve got a lot of flights to work with.
We could use command line tools to explore this further but Cypher&#8217;s <code>LOAD CSV</code> command is actually perfect for exploring CSV files.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://localhost:8001/img/slides.jpg" alt="slides">
</div>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Exploring data with <code>LOAD CSV</code></h3>
    <br/>
    <div>
      <div class="paragraph">
<p>While we&#8217;re working out the appropriate model for our dataset it&#8217;s much easier to work with a subset of the data so that we can iterate quickly.
A smaller dataset containing the first 10,000 flights lives in <code>flights_initial.csv</code>.</p>
</div>
<div class="paragraph">
<p>We can run the following query to see what data we&#8217;ve got to work with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre mode="cypher"  class="highlight pre-scrollable programlisting cm-s-neo code runnable standalone-example ng-binding" data-lang="cypher" lang="cypher"><!--code class="cypher language-cypher"-->LOAD CSV WITH HEADERS FROM "file:///flights_initial.csv" AS row
RETURN row
LIMIT 5<!--/code--></pre>
</div>
</div>
<div class="paragraph">
<p>This query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>loads the file <code>flights_initial.csv</code></p>
</li>
<li>
<p>iterates over the file, referring to each line as the variable <code>row</code></p>
</li>
<li>
<p>and returns the first 5 lines in the file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;ve got lots of different fields but the ones that will be helpful for answering our question are: <code>Origin</code>, <code>Dest</code>, and <code>FlightNum</code>.</p>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Modeling flights and airports</h3>
    <br/>
    <div>
      <div class="paragraph">
<p>Before we use <code>LOAD CSV</code> to import any data we need to know what model we want to create.
The following should suffice:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://localhost:8001/img/initial.png" alt="initial" width="100%">
</div>
</div>
<div class="paragraph">
<p>We should do a quite primer here on the building blocks of the model.</p>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Importing flights and airports</h3>
    <br/>
    <div>
      <div class="paragraph">
<p>Run the following query to create nodes and relationships for these flights:</p>
</div>
<div class="listingblock">
<div class="content">
<pre mode="cypher"  class="highlight pre-scrollable programlisting cm-s-neo code runnable standalone-example ng-binding" data-lang="cypher" lang="cypher"><!--code class="cypher language-cypher"-->LOAD CSV WITH HEADERS FROM "file:///flights_initial.csv" AS row
MERGE (origin:Airport {code: row.Origin})
MERGE (destination:Airport {code: row.Dest})
MERGE (origin)-[flight:HAS_FLIGHT {
  airline: row.UniqueCarrier,
  flightNumber: row.FlightNum,
  year: TOINT(row.Year),
  month: TOINT(row.Month),
  day: TOINT(row.DayofMonth)}]->(destination)
ON CREATE SET flight.departure = TOINT(row.CRSDepTime), flight.arrival = TOINT(row.CRSArrTime)<!--/code--></pre>
</div>
</div>
<div class="paragraph">
<p>This query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>iterates through each row in the file</p>
</li>
<li>
<p>creates nodes with the <code>Airport</code> label for the origin and destination airports if they don&#8217;t already exist</p>
</li>
<li>
<p>creates a <code>FLIGHT</code> relationship between origin and destination airports for each row in the file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default properties will be stored as strings.
We know that <code>year</code>, <code>month</code>, and <code>day</code> are actually numeric values so we&#8217;ll coerce them using the <a href="/docs"><code>TOINT</code></a> function.</p>
</div>
<div class="paragraph">
<p>Now we&#8217;re ready to start querying the data.</p>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Finding the most popular airports</h3>
    <br/>
    <div>
      <div class="paragraph">
<p>We can see some of what we&#8217;ve imported by writing the following query, which finds the airports with the outgoing flights.</p>
</div>
<div class="listingblock">
<div class="content">
<pre mode="cypher"  class="highlight pre-scrollable programlisting cm-s-neo code runnable standalone-example ng-binding" data-lang="cypher" lang="cypher"><!--code class="cypher language-cypher"-->MATCH (a:Airport)-[:HAS_FLIGHT]-&gt;()
RETURN a, COUNT(*) AS outgoing
ORDER BY outgoing DESC
LIMIT 10<!--/code--></pre>
</div>
</div>
<div class="paragraph">
<p>This query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>finds every node with the <code>Airport</code> label</p>
</li>
<li>
<p>finds all outgoing <code>HAS_FLIGHT</code> relationships</p>
</li>
<li>
<p>counts them up grouped by airport</p>
</li>
<li>
<p>returns the <code>Airport</code> nodes and the <code>outgoing</code> count in descending order by <code>outgoing</code></p>
</li>
<li>
<p>limits the number of airports returned to 10</p>
</li>
</ul>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Exercise: Finding flights</h3>
    <br/>
    <div>
      <div class="paragraph">
<p>Now it&#8217;s your turn!
Try and write queries to answer the following questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Find the airports that have the most incoming flights</p>
</li>
<li>
<p>Find all the flights that go to Las Vegas (<code>LAS</code>)</p>
</li>
<li>
<p>Find all the flights from Las Vegas (<code>LAS</code>) to Los Angeles (<code>LAX</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Hint</em> You&#8217;ll want to refer to the <a href="http://neo4j.com/docs/stable/cypher-refcard/">Cypher refcard</a> for the syntax for the second question.</p>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Click through for the answers</h3>
    <br/>
    <div>
      <div class="paragraph">
<p>If you really want to see them&#8230;&#8203;</p>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Answer: Find the airports that have the most incoming flights</h3>
    <br/>
    <div>
      <div class="listingblock">
<div class="content">
<pre mode="cypher"  class="highlight pre-scrollable programlisting cm-s-neo code runnable standalone-example ng-binding" data-lang="cypher" lang="cypher"><!--code class="cypher language-cypher"-->MATCH (a:Airport)&lt;-[:HAS_FLIGHT]-()
RETURN a, COUNT(*) AS incoming
ORDER BY incoming DESC
LIMIT 10<!--/code--></pre>
</div>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Answer: Find all the flights that go to Las Vegas (<code>LAS</code>)</h3>
    <br/>
    <div>
      <div class="listingblock">
<div class="content">
<pre mode="cypher"  class="highlight pre-scrollable programlisting cm-s-neo code runnable standalone-example ng-binding" data-lang="cypher" lang="cypher"><!--code class="cypher language-cypher"-->MATCH (origin:Airport)-[flight:HAS_FLIGHT]-&gt;(destination:Airport)
WHERE destination.code = "LAS"
RETURN origin, destination, flight
LIMIT 10<!--/code--></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre mode="cypher"  class="highlight pre-scrollable programlisting cm-s-neo code runnable standalone-example ng-binding" data-lang="cypher" lang="cypher"><!--code class="cypher language-cypher"-->MATCH (origin:Airport)-[flight:HAS_FLIGHT]-&gt;(destination:Airport {code: "LAS"})
RETURN origin, destination, flight
LIMIT 10<!--/code--></pre>
</div>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Answer: Find all the flights from Las Vegas (<code>LAS</code>) to Los Angeles (<code>LAX</code>)</h3>
    <br/>
    <div>
      <div class="listingblock">
<div class="content">
<pre mode="cypher"  class="highlight pre-scrollable programlisting cm-s-neo code runnable standalone-example ng-binding" data-lang="cypher" lang="cypher"><!--code class="cypher language-cypher"-->MATCH (origin:Airport {code: "LAX"})-[flight:HAS_FLIGHT]-&gt;(destination:Airport {code: "LAS"})
RETURN origin, destination, flight
LIMIT 10<!--/code--></pre>
</div>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Finding specific flights</h3>
    <br/>
    <div>
      <div class="paragraph">
<p>The model has worked well so far.
We&#8217;ve been able to find the popular airports and find the flights between pairs of airports without much trouble.</p>
</div>
<div class="paragraph">
<p>What about if we want to find all the occurrences of a specific flight?</p>
</div>
<div class="verseblock">
<pre class="content">As a plane enthusiast
I want to know the schedule for &lt;flight number&gt;
So that I know when I&#8217;ll be able to spot those planes taking off and landing</pre>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Finding flight <code>WN 1016</code></h3>
    <br/>
    <div>
      <div class="paragraph">
<p>Our next query finds all the instances of flight <code>WN 1016</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre mode="cypher"  class="highlight pre-scrollable programlisting cm-s-neo code runnable standalone-example ng-binding" data-lang="cypher" lang="cypher"><!--code class="cypher language-cypher"-->MATCH  (origin:Airport)-[flight:HAS_FLIGHT]-&gt;(destination:Airport)
WHERE flight.airline = "WN" AND flight.flightNumber = "1016"
RETURN origin.code, destination.code, flight.year, flight.month, flight.day, flight.departure, flight.arrival
ORDER BY flight.year, flight.month, flight.day, flight.departure<!--/code--></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s still reasonably quick because we only have 10,000 rows, but under the covers we&#8217;re actually doing a lot of unnecessary work.</p>
</div>
	</div>
  </div>
</slide>



<slide class="row-fluid">
  <div class="col-sm-12">
    <h3>Next Step</h3>
    <br/>
    <div>
      <div class="paragraph">
<p>In the next section we&#8217;re going to learn how to <strong>profile queries</strong> so that we can see what work&#8217;s actually being done.
We&#8217;ll then refactor the model to introduce <code>Flight</code> as a first class concept.</p>
</div>
<div class="paragraph">
<p><a play-topic='http://localhost:8001/02_flight.html'>Flight as a first class citizen</a></p>
</div>
	</div>
  </div>
</slide>
  </carousel>
</article>